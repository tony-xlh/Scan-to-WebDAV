<!DOCTYPE html>
<html>

<head>
  <title>Scan to WebDAV</title>
  <script src="https://unpkg.com/dwt@18.0.0/dist/dynamsoft.webtwain.min.js"></script>
  <style>
    .scanButton {
      height: 25px;
    }

    #dwtcontrolContainer {
      width: 360px;
      height: 480px;
    }
  </style>
</head>

<body>
  <div>
    <input class="scanButton" type="button" value="Scan" onclick="AcquireImage();" />
    <input class="sendButton" type="button" value="Send" onclick="connect();" />
    <div>
      <div>
        <label>
          Server URL:
          <input type="text" id="URL" value="http://127.0.0.1:8080/remote.php/dav/files/admin/"/>
        </label>
      </div>
      <div>
        <label>
          Username:
          <input type="text" id="username"/>
        </label>
      </div>
      <div>
        <label>
          Password:
          <input type="password" id="password"/>
        </label>
      </div>
    </div>
    <div id="dwtcontrolContainer"></div>
  </div>
  <script type="text/javascript">
    let DWObject;
    Dynamsoft.DWT.AutoLoad = false;
    Dynamsoft.DWT.ResourcesPath = "https://unpkg.com/dwt@18.0.0/dist";
    init();

    function init(){
      Dynamsoft.DWT.Containers = [{ ContainerId: "dwtcontrolContainer",Width: 270, Height: 350 }];
      Dynamsoft.DWT.RegisterEvent("OnWebTwainReady", function () {
        console.log("ready");
        DWObject = Dynamsoft.DWT.GetWebTwain("dwtcontrolContainer");
        DWObject.Viewer.width = "100%";
        DWObject.Viewer.height = "100%";
        DWObject.SetViewMode(2,2);
      });
      Dynamsoft.DWT.Load();
    }

    async function AcquireImage() {
      if (DWObject) {
        if (Dynamsoft.Lib.env.bMobile) {
          DWObject.Addon.Camera.scanDocument();
        }else{
          const index = await DWObject.SelectSourceAsync();
          DWObject.AcquireImageAsync({SelectSourceByIndex:index});
        }
      }
    }

    function connect(){
      let xhr = new XMLHttpRequest();
      let pay_load = {};
      pay_load["URL"] = document.getElementById("URL").value;
      pay_load["username"] = document.getElementById("username").value;
      pay_load["password"] = document.getElementById("password").value;
      console.log(pay_load);
      xhr.open("POST", "/uploadfile");
      xhr.setRequestHeader("content-type", "application/json"); 

      xhr.onreadystatechange = function(){
        if(xhr.readyState === 4){
          if (xhr.status === 200) {
            console.log(xhr.responseText);
          }
        }
      }
      xhr.send(JSON.stringify(pay_load));
    }

  </script>
</body>

</html>